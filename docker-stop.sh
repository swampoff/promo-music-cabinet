#!/bin/bash

# üõë –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ Promo.Music Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

set -e

echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é Promo.Music Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
echo ""

# –ò—Å–ø–æ–ª—å–∑—É–µ–º docker compose (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è) –∏–ª–∏ docker-compose (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
if docker compose version &> /dev/null; then
    COMPOSE_CMD="docker compose"
else
    COMPOSE_CMD="docker-compose"
fi

# –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:"
echo "1) –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)"
echo "2) –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã + —É–¥–∞–ª–∏—Ç—å volumes (–ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞)"
echo ""
read -p "–í–∞—à –≤—ã–±–æ—Ä (1 –∏–ª–∏ 2): " choice

case $choice in
    1)
        echo ""
        echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
        $COMPOSE_CMD down
        echo "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)"
        ;;
    2)
        echo ""
        echo "üóëÔ∏è  –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —É–¥–∞–ª—è—é volumes..."
        $COMPOSE_CMD down -v
        echo "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã"
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 1 –∏–ª–∏ 2"
        exit 1
        ;;
esac

echo ""
echo "üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
$COMPOSE_CMD ps
echo ""
echo "üí° –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ./docker-start.sh"
echo ""

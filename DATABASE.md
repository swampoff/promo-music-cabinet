# üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö promo.music

## üìå –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–í **Figma Make** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Key-Value Store** –Ω–∞ –±–∞–∑–µ Supabase PostgreSQL.

–í–º–µ—Å—Ç–æ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö SQL —Ç–∞–±–ª–∏—Ü, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `kv_store_84730125` –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ key (TEXT, PRIMARY KEY)      ‚îÇ value (TEXT)       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ track:user-123:track-1       ‚îÇ {"id":"track-1"...}‚îÇ
‚îÇ profile:user-123             ‚îÇ {"name":"..."...}  ‚îÇ
‚îÇ coins:balance:user-123       ‚îÇ "5000"             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ KV Store:

- **–ì–∏–±–∫–æ—Å—Ç—å**: –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å—Ö–µ–º—ã
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ DDL statements
- **–ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### üîë –§–æ—Ä–º–∞—Ç –∫–ª—é—á–µ–π:

```
{entity_type}:{user_id}:{entity_id}
```

–ü—Ä–∏–º–µ—Ä—ã:
```
track:demo-user:1706184123456-abc123
concert:demo-user:1706184200000-xyz789
coins:balance:demo-user
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º

### 1Ô∏è‚É£ TRACKS (–¢—Ä–µ–∫–∏)

**Key format**: `track:{userId}:{trackId}`

**Value (JSON)**:
```json
{
  "id": "1706184123456-abc123",
  "title": "Midnight Dreams",
  "artist": "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–≤–∞–Ω–æ–≤",
  "album": "Summer Nights",
  "genre": "Electronic",
  "duration": 245,
  "coverUrl": "https://example.com/cover.jpg",
  "audioUrl": "https://example.com/track.mp3",
  "plays": 12500,
  "likes": 340,
  "downloads": 120,
  "createdAt": "2024-01-25T10:00:00.000Z",
  "updatedAt": "2024-01-25T10:00:00.000Z",
  "userId": "demo-user"
}
```

**–û–ø–µ—Ä–∞—Ü–∏–∏**:
```typescript
// –°–æ–∑–¥–∞—Ç—å
await kv.set(`track:${userId}:${trackId}`, JSON.stringify(track));

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const tracks = await kv.getByPrefix(`track:${userId}:`);

// –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —Ç—Ä–µ–∫
const track = await kv.get(`track:${userId}:${trackId}`);

// –£–¥–∞–ª–∏—Ç—å
await kv.del(`track:${userId}:${trackId}`);
```

---

### 2Ô∏è‚É£ ANALYTICS (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–∫–æ–≤)

**Key format**: `analytics:{userId}:track:{trackId}`

**Value (JSON)**:
```json
{
  "trackId": "1706184123456-abc123",
  "plays": 12500,
  "likes": 340,
  "downloads": 120,
  "shares": 45,
  "comments": 23,
  "dailyStats": [
    {
      "date": "2024-01-25",
      "plays": 1250,
      "likes": 34
    }
  ]
}
```

**–ü—Ä–∏–º–µ—Ä**:
```typescript
const analyticsKey = `analytics:${userId}:track:${trackId}`;
const analytics = await kv.get(analyticsKey);

// –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π
const data = JSON.parse(analytics);
data.plays += 1;
await kv.set(analyticsKey, JSON.stringify(data));
```

---

### 3Ô∏è‚É£ CONCERTS (–ö–æ–Ω—Ü–µ—Ä—Ç—ã)

**Key format**: `concert:{userId}:{concertId}`

**Value (JSON)**:
```json
{
  "id": "1706184123456-concert1",
  "title": "Summer Electronic Festival 2024",
  "venue": "–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ",
  "city": "–ú–æ—Å–∫–≤–∞",
  "date": "2024-07-15",
  "time": "20:00",
  "ticketPrice": 2500,
  "ticketUrl": "https://tickets.com/123",
  "imageUrl": "https://example.com/concert.jpg",
  "description": "–ì—Ä–∞–Ω–¥–∏–æ–∑–Ω—ã–π –ª–µ—Ç–Ω–∏–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å",
  "userId": "demo-user",
  "createdAt": "2024-01-25T10:00:00.000Z",
  "updatedAt": "2024-01-25T10:00:00.000Z"
}
```

---

### 4Ô∏è‚É£ VIDEOS (–í–∏–¥–µ–æ)

**Key format**: `video:{userId}:{videoId}`

**Value (JSON)**:
```json
{
  "id": "1706184123456-video1",
  "title": "Official Music Video",
  "description": "Official video for Midnight Dreams",
  "thumbnailUrl": "https://example.com/thumb.jpg",
  "videoUrl": "https://youtube.com/watch?v=...",
  "duration": 245,
  "views": 15000,
  "likes": 850,
  "userId": "demo-user",
  "createdAt": "2024-01-25T10:00:00.000Z",
  "updatedAt": "2024-01-25T10:00:00.000Z"
}
```

---

### 5Ô∏è‚É£ NEWS (–ù–æ–≤–æ—Å—Ç–∏)

**Key format**: `news:{userId}:{newsId}`

**Value (JSON)**:
```json
{
  "id": "1706184123456-news1",
  "title": "–ù–æ–≤—ã–π –∞–ª—å–±–æ–º —É–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω!",
  "content": "–†–∞–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –≤–∞–º –º–æ–π –Ω–æ–≤—ã–π –∞–ª—å–±–æ–º...",
  "imageUrl": "https://example.com/news.jpg",
  "likes": 234,
  "comments": 56,
  "userId": "demo-user",
  "createdAt": "2024-01-25T10:00:00.000Z",
  "updatedAt": "2024-01-25T10:00:00.000Z"
}
```

---

### 6Ô∏è‚É£ DONATIONS (–î–æ–Ω–∞—Ç—ã)

**Key format**: `donation:{artistId}:{donationId}`

**Value (JSON)**:
```json
{
  "id": "1706184123456-donation1",
  "donorName": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "amount": 500,
  "message": "–°–ø–∞—Å–∏–±–æ –∑–∞ –º—É–∑—ã–∫—É!",
  "artistId": "demo-user",
  "createdAt": "2024-01-25T10:00:00.000Z",
  "status": "completed"
}
```

---

### 7Ô∏è‚É£ COINS - Balance (–ë–∞–ª–∞–Ω—Å –∫–æ–∏–Ω–æ–≤)

**Key format**: `coins:balance:{userId}`

**Value (String - —á–∏—Å–ª–æ)**:
```
"5000"
```

**–ü—Ä–∏–º–µ—Ä**:
```typescript
// –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
const balance = await kv.get(`coins:balance:${userId}`);
const balanceInt = balance ? parseInt(balance) : 0;

// –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
const newBalance = balanceInt + 1000;
await kv.set(`coins:balance:${userId}`, String(newBalance));
```

---

### 8Ô∏è‚É£ COINS - Transactions (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–æ–∏–Ω–æ–≤)

**Key format**: `coins:tx:{userId}:{transactionId}`

**Value (JSON)**:
```json
{
  "id": "1706184123456-tx1",
  "userId": "demo-user",
  "amount": 1000,
  "type": "purchase",
  "description": "–ö—É–ø–∏–ª 1000 –∫–æ–∏–Ω–æ–≤",
  "createdAt": "2024-01-25T10:00:00.000Z"
}
```

**–¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**:
- `purchase` - –ü–æ–∫—É–ø–∫–∞ –∫–æ–∏–Ω–æ–≤ (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞)
- `spend` - –¢—Ä–∞—Ç–∞ –∫–æ–∏–Ω–æ–≤ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞)
- `reward` - –ù–∞–≥—Ä–∞–¥–∞/–±–æ–Ω—É—Å (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞)

---

### 9Ô∏è‚É£ PROFILE (–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**Key format**: `profile:{userId}`

**Value (JSON)**:
```json
{
  "userId": "demo-user",
  "name": "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–≤–∞–Ω–æ–≤",
  "avatar": "https://example.com/avatar.jpg",
  "bio": "–†–æ—Å—Å–∏–π—Å–∫–∏–π –º—É–∑—ã–∫–∞–Ω—Ç, –ø—Ä–æ–¥—é—Å–µ—Ä —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –º—É–∑—ã–∫–∏",
  "subscribers": 12500,
  "totalPlays": 450000,
  "totalTracks": 35,
  "updatedAt": "2024-01-25T10:00:00.000Z"
}
```

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```typescript
import * as kv from './kv_store.tsx';

const userId = 'demo-user';
const tracksRaw = await kv.getByPrefix(`track:${userId}:`);
const tracks = tracksRaw.map(t => JSON.parse(t));

console.log(`–ù–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–∫–æ–≤: ${tracks.length}`);
```

### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç—Ä–µ–∫

```typescript
const trackId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
const track = {
  id: trackId,
  title: 'New Song',
  artist: 'Artist Name',
  plays: 0,
  likes: 0,
  downloads: 0,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
  userId
};

const key = `track:${userId}:${trackId}`;
await kv.set(key, JSON.stringify(track));
```

### –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π

```typescript
const trackKey = `track:${userId}:${trackId}`;
const trackData = await kv.get(trackKey);

if (trackData) {
  const track = JSON.parse(trackData);
  track.plays += 1;
  track.updatedAt = new Date().toISOString();
  
  await kv.set(trackKey, JSON.stringify(track));
}
```

### –£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫

```typescript
await kv.del(`track:${userId}:${trackId}`);
```

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–∞—à–±–æ—Ä–¥–∞

```typescript
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏
const tracks = await kv.getByPrefix(`track:${userId}:`);

// –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—ã
let totalPlays = 0;
let totalLikes = 0;

tracks.forEach(trackStr => {
  const track = JSON.parse(trackStr);
  totalPlays += track.plays || 0;
  totalLikes += track.likes || 0;
});

// –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–æ–∏–Ω–æ–≤
const balance = await kv.get(`coins:balance:${userId}`);
const coinsBalance = balance ? parseInt(balance) : 0;

const stats = {
  totalPlays,
  totalLikes,
  tracksCount: tracks.length,
  coinsBalance
};
```

---

## üìê –°—Ö–µ–º–∞ –∫–ª—é—á–µ–π (Key Schema)

```
promo-music/
‚îú‚îÄ‚îÄ track:{userId}:{trackId}               # –¢—Ä–µ–∫–∏
‚îú‚îÄ‚îÄ analytics:{userId}:track:{trackId}     # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ concert:{userId}:{concertId}           # –ö–æ–Ω—Ü–µ—Ä—Ç—ã
‚îú‚îÄ‚îÄ video:{userId}:{videoId}               # –í–∏–¥–µ–æ
‚îú‚îÄ‚îÄ news:{userId}:{newsId}                 # –ù–æ–≤–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ donation:{userId}:{donationId}         # –î–æ–Ω–∞—Ç—ã
‚îú‚îÄ‚îÄ coins:balance:{userId}                 # –ë–∞–ª–∞–Ω—Å –∫–æ–∏–Ω–æ–≤
‚îú‚îÄ‚îÄ coins:tx:{userId}:{transactionId}      # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–æ–∏–Ω–æ–≤
‚îî‚îÄ‚îÄ profile:{userId}                       # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

---

## üîê User Isolation

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ `userId`:

```typescript
// User A
track:user-a:track-1
track:user-a:track-2

// User B  
track:user-b:track-1
track:user-b:track-2
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–µ—Ñ–∏–∫—Å–∞–º –∫–ª—é—á–µ–π.

---

## ‚ö° KV Store API

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `/supabase/functions/server/kv_store.tsx`:

### `get(key: string): Promise<string | null>`

–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É.

```typescript
const value = await kv.get('track:user-123:track-1');
```

### `set(key: string, value: string): Promise<void>`

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ.

```typescript
await kv.set('profile:user-123', JSON.stringify(profile));
```

### `del(key: string): Promise<void>`

–£–¥–∞–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ.

```typescript
await kv.del('track:user-123:track-1');
```

### `mget(keys: string[]): Promise<(string | null)[]>`

–ü–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π.

```typescript
const values = await kv.mget([
  'track:user-123:track-1',
  'track:user-123:track-2'
]);
```

### `mset(entries: [string, string][]): Promise<void>`

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π.

```typescript
await kv.mset([
  ['track:user-123:track-1', JSON.stringify(track1)],
  ['track:user-123:track-2', JSON.stringify(track2)]
]);
```

### `mdel(keys: string[]): Promise<void>`

–£–¥–∞–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π.

```typescript
await kv.mdel([
  'track:user-123:track-1',
  'track:user-123:track-2'
]);
```

### `getByPrefix(prefix: string): Promise<string[]>`

–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–º.

```typescript
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const tracks = await kv.getByPrefix('track:user-123:');
```

---

## üéØ Best Practices

### 1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã —Å userId

```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
const key = `track:${userId}:${trackId}`;

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
const key = `track:${trackId}`; // –ù–µ—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

### 2. –•—Ä–∞–Ω–∏—Ç–µ JSON –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏

```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
await kv.set(key, JSON.stringify(data));
const value = await kv.get(key);
const data = JSON.parse(value);

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
await kv.set(key, data); // –û–±—ä–µ–∫—Ç—ã –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é
```

### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ timestamp –¥–ª—è ID

```typescript
// ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
const id = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
// –ù–∞–ø—Ä–∏–º–µ—Ä: "1706184123456-abc123xyz"

// ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–ª–ª–∏–∑–∏—è
const id = Math.random().toString();
```

### 4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ null –∑–Ω–∞—á–µ–Ω–∏—è

```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
const value = await kv.get(key);
if (!value) {
  return { error: 'Not found' };
}
const data = JSON.parse(value);

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
const value = await kv.get(key);
const data = JSON.parse(value); // –ú–æ–∂–µ—Ç –±—ã—Ç—å null
```

### 5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ getByPrefix –¥–ª—è —Å–ø–∏—Å–∫–æ–≤

```typescript
// ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
const tracks = await kv.getByPrefix(`track:${userId}:`);

// ‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ - –Ω–µ—Ç list —Ñ—É–Ω–∫—Ü–∏–∏
// const tracks = await kv.list(); // –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢
```

---

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ SQL —Ç–∞–±–ª–∏—Ü—ã:

### SQL Schema –¥–ª—è PostgreSQL

```sql
-- –¢—Ä–µ–∫–∏
CREATE TABLE tracks (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  title TEXT NOT NULL,
  artist TEXT,
  album TEXT,
  genre TEXT,
  duration INTEGER,
  cover_url TEXT,
  audio_url TEXT,
  plays INTEGER DEFAULT 0,
  likes INTEGER DEFAULT 0,
  downloads INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
CREATE TABLE track_analytics (
  track_id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  plays INTEGER DEFAULT 0,
  likes INTEGER DEFAULT 0,
  downloads INTEGER DEFAULT 0,
  shares INTEGER DEFAULT 0,
  comments INTEGER DEFAULT 0,
  FOREIGN KEY (track_id) REFERENCES tracks(id)
);

-- –ö–æ–Ω—Ü–µ—Ä—Ç—ã
CREATE TABLE concerts (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  title TEXT NOT NULL,
  venue TEXT,
  city TEXT,
  date DATE,
  time TIME,
  ticket_price DECIMAL,
  ticket_url TEXT,
  image_url TEXT,
  description TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...
```

### –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ KV ‚Üí SQL

```typescript
async function migrateToSQL() {
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏ –∏–∑ KV
  const tracksKV = await kv.getByPrefix('track:');
  
  // –í—Å—Ç–∞–≤–∏—Ç—å –≤ SQL
  for (const trackStr of tracksKV) {
    const track = JSON.parse(trackStr);
    
    await supabase
      .from('tracks')
      .insert(track);
  }
}
```

---

## üìù –†–µ–∑—é–º–µ

‚úÖ **KV Store** - –≥–∏–±–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è  
‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º  
‚úÖ –ü—Ä–æ—Å—Ç—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `kv_store.tsx`  
‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏  
‚úÖ –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è  

**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è Figma Make –∏ –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! üöÄ**
